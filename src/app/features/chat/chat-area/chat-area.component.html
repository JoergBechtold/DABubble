<!-- src/app/features/chat/chat-area/chat-area.component.html -->

<mat-card class="chat-area">
  <!-- Chat Header -->
  <div class="chat-header">
    <div class="chat-info">
      <h2>{{ currentChatName }}</h2>
      <span class="member-count" *ngIf="memberCount > 0">{{ memberCount }} Mitglieder</span>
      <button class="chat-info-btn" (click)="openSettings()" title="Channel-Einstellungen">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 8V4L8 8L12 8ZM12 8V12M12 8H16L12 4V8ZM12 8H8L12 12V8ZM12 8L16 12H12V8ZM12 8V12L8 8H12ZM12 8L8 4H12V8Z" stroke="currentColor" stroke-width="1.5"/>
        </svg>
      </button>
    </div>

    <div class="header-actions">
      <button class="btn-members" title="Mitglieder anzeigen">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M2 18C2 17.45 2 16.9793 2 16.588C2 16.1967 2 15.7257 2 15.175C2 14.6243 2.17933 14.121 2.538 13.665C2.896 13.2083 3.35 12.85 3.9 12.59C5.1 12.01 6.35 11.604 7.65 11.371C8.95 11.1377 10.2667 11.0213 11.6 11.022C12.9333 11.0227 14.25 11.1393 15.55 11.372C16.85 11.6047 18.1 12.0107 19.3 12.59C19.85 12.85 20.304 13.2083 20.662 13.665C21.0207 14.121 21.2 14.6243 21.2 15.175C21.2 15.7257 21.2 16.1967 21.2 16.588C21.2 16.9793 21.2 17.45 21.2 18H19.2V17.2C19.2 17.0167 19.1543 16.85 19.063 16.7C18.971 16.55 18.85 16.4333 18.7 16.35C17.8 15.9 16.8917 15.5623 15.975 15.337C15.0583 15.1123 14.1333 15 13.2 15C12.2667 15 11.3417 15.1123 10.425 15.337C9.50833 15.5623 8.6 15.9 7.7 16.35C7.55 16.4333 7.42933 16.55 7.338 16.7C7.246 16.85 7.2 17.0167 7.2 17.2V18H2ZM13.2 10C12.65 10 12.1793 9.804 11.788 9.412C11.396 9.02067 11.2 8.55 11.2 8C11.2 7.45 11.396 6.97933 11.788 6.588C12.1793 6.196 12.65 6 13.2 6C13.75 6 14.2207 6.196 14.612 6.588C15.004 6.97933 15.2 7.45 15.2 8C15.2 8.55 15.004 9.02067 14.612 9.412C14.2207 9.804 13.75 10 13.2 10ZM2 16V14C2 13.45 2.196 12.9793 2.588 12.588C2.97933 12.196 3.45 12 4 12H6C6.55 12 7.02067 12.196 7.412 12.588C7.804 12.9793 8 13.45 8 14V16H6V14H4V16H2ZM4 10C3.45 10 2.97933 9.804 2.588 9.412C2.196 9.02067 2 8.55 2 8C2 7.45 2.196 6.97933 2.588 6.588C2.97933 6.196 3.45 6 4 6C4.55 6 5.02067 6.196 5.412 6.588C5.804 6.97933 6 7.45 6 8C6 8.55 5.804 9.02067 5.412 9.412C5.02067 9.804 4.55 10 4 10Z" fill="black"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoadingMessages" class="loading-state">
    <p>Nachrichten werden geladen...</p>
  </div>

  <!-- Message Area -->
  <div class="messages-container" #messagesContainer *ngIf="!isLoadingMessages">
    <!-- Show real messages from Firebase -->
    <app-message-item 
      *ngFor="let message of messages; trackBy: trackByMessageId" 
      [message]="message"
      (replyClicked)="onReplyToMessage($event)">
    </app-message-item>

    <!-- No messages state -->
    <div *ngIf="messages.length === 0" class="no-messages">
      <p>Noch keine Nachrichten in diesem Channel. Sei der Erste der schreibt! ðŸ’¬</p>
    </div>
  </div>

  <!-- Message Input -->
  <div class="message-input-container">
    <app-message-input [channelId]="channelId"></app-message-input>
  </div>

  <!-- Settings-Card Overlay -->
  <app-channel-settings
    *ngIf="showSettings"
    [channelId]="currentChannel?.id || ''"
    [channelName]="currentChatName"
    [channelDescription]="currentChannel?.description || ''"
    [createdByName]="createdByName"
    (close)="closeSettings()"
    (saved)="onSettingsSaved()"
    (left)="onChannelLeft()">
  </app-channel-settings>
</mat-card>