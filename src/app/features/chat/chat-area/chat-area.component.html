<!-- src/app/features/chat/chat-area/chat-area.component.html -->

<mat-card class="chat-area">
  <!-- Header Section -->
  <div class="chat-header">
    <div class="chat-info" (click)="openSettings()">
      @if (isDM) {
      <app-profile-avatar [user]="dmUserSig && dmUserSig()" [imgSize]="40" [showStatus]="false"></app-profile-avatar>
      <h2>{{ (dmUserSig && dmUserSig()?.displayName) || 'Unknown User' }}</h2>
      } @else {
      <h2>{{ currentChatName }}</h2>
      <!-- Channel Settings Button -->
      <button class="chat-info-btn" aria-label="Channel-Einstellungen">
        <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
          <mask id="mask0_235_460" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="30"
            height="30">
            <rect width="30" height="30" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_235_460)">
            <path
              d="M15 19.1875C14.8333 19.1875 14.6721 19.1562 14.5162 19.0937C14.3596 19.0312 14.2292 18.9479 14.125 18.8437L8.375 13.0938C8.14583 12.8646 8.03125 12.5729 8.03125 12.2187C8.03125 11.8646 8.14583 11.5729 8.375 11.3437C8.60417 11.1146 8.89583 11 9.25 11C9.60417 11 9.89583 11.1146 10.125 11.3437L15 16.2188L19.875 11.3437C20.1042 11.1146 20.3958 11 20.75 11C21.1042 11 21.3958 11.1146 21.625 11.3437C21.8542 11.5729 21.9688 11.8646 21.9688 12.2187C21.9688 12.5729 21.8542 12.8646 21.625 13.0938L15.875 18.8437C15.75 18.9687 15.6146 19.0571 15.4688 19.1087C15.3229 19.1612 15.1667 19.1875 15 19.1875Z"
              fill="black" />
          </g>
        </svg>
      </button>
      }
    </div>

    <div *ngIf="!isDM" class="header-actions">
      <app-members-miniatur-info class="members-miniatur-info" [channel]="currentChannel"></app-members-miniatur-info>
      <app-btn-add-members [channel]="currentChannel"></app-btn-add-members>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoadingMessages" class="loading-state">
    <p>Nachrichten werden geladen...</p>
  </div>

  <!-- Message Area -->
  <div class="messages-container" #messagesContainer *ngIf="!isLoadingMessages">
    <!-- Show real messages from Firebase -->
    <app-message-item *ngFor="let message of messages; trackBy: trackByMessageId" [message]="message"
      (replyClicked)="onReplyToMessage($event)">
    </app-message-item>

    <!-- No messages state -->
    <div *ngIf="messages.length === 0" class="no-messages">
      <p>Noch keine Nachrichten in diesem Channel. Sei der Erste der schreibt! ðŸ’¬</p>
    </div>
  </div>

  <!-- Message Input -->
  <div class="message-input-container">
    <app-message-input [channelId]="channelId" [userId]="userId" [isDM]="isDM">
    </app-message-input>
  </div>

  <!-- Settings-Card Overlay -->
  <app-channel-settings *ngIf="showSettings" [channelId]="currentChannel?.id || ''" [channelName]="currentChatName"
    [channelDescription]="currentChannel?.description || ''" [createdByName]="createdByName" (close)="closeSettings()"
    (saved)="onSettingsSaved()" (left)="onChannelLeft()">
  </app-channel-settings>
</mat-card>